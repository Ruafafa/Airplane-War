!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexquadimageplugin=e();}(undefined,(function(){function t(t,i,n){return i=u(i),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(t,e()?Reflect.construct(i,n||[],u(t).constructor):i.apply(t,n))}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));}catch(t){}return (e=function(){return !!t})()}function i(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(t,"string");return "symbol"==typeof e?e:String(e)}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r);}}function s(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e);}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},l.apply(this,arguments)}var f=function(e){function i(){return r(this,i),t(this,i,arguments)}return a(i,e),s(i,[{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),i}(Phaser.GameObjects.Mesh),d=Phaser.Math.RotateAround,y=function(t,e,i){var n=t.width/2,r=t.height/2;return v.x=e-n,v.y=i-r,d(v,0,0,t.rotation),v.x*=t.scaleX,v.y*=t.scaleY,v.x+=t.x,v.y+=t.y,v},v={x:0,y:0},g=function(){function t(e,i){r(this,t),this.parent=e,this.vertex=i,this._localX=void 0,this._localY=void 0;}return s(t,[{key:"destroy",value:function(){this.parent=void 0,this.vertex=void 0;}},{key:"updateVertexPosition",value:function(t,e){var i=this.parent,n=i.height,r=t/n-i.frame.cutWidth/n/2,o=e/n-i.frame.cutHeight/n/2,s=this.vertex;return s.x=r,s.y=-o,i.forceUpdate(),this}},{key:"localX",get:function(){return this._localX},set:function(t){this.setLocalXY(t,this._localY);}},{key:"localY",get:function(){return this._localY},set:function(t){this.setLocalXY(this._localX,t);}},{key:"localXOrigin",get:function(){return this._localXOrigin}},{key:"localYOrigin",get:function(){return this._localYOrigin}},{key:"resetLocalXY",value:function(t,e){return this._localXOrigin=t,this._localYOrigin=e,this._localX=t,this._localY=e,this}},{key:"setLocalXY",value:function(t,e,i){return this._localX===t&&this._localY===e||(this._localX=t,this._localY=e,i||this.updateVertexPosition(t,e)),this}},{key:"setWorldXY",value:function(t,e){if(this._worldX===t&&this._worldY===e)return this;var i,n,r,o,s,a=(i=this.parent,n=t,r=e,o=i.width/2,s=i.height/2,v.x=n-i.x,v.y=r-i.y,v.x/=i.scaleX,v.y/=i.scaleY,d(v,0,0,-i.rotation),v.x+=o,v.y+=s,v);return this.setLocalXY(a.x,a.y),this}},{key:"setPosition",value:function(t,e){return this.setWorldXY(t,e),this}},{key:"getWorldXY",value:function(){return y(this.parent,this._localX,this._localY)}},{key:"x",get:function(){return y(this.parent,this._localX,this._localY).x},set:function(t){this.setWorldXY(t,this.y);}},{key:"y",get:function(){return y(this.parent,this._localX,this._localY).y},set:function(t){this.setWorldXY(this.x,t);}}]),t}(),p=Phaser.Geom.Mesh.Vertex,w=Phaser.Geom.Mesh.Face,x=[0,2,3,0,3,1],b=[1,3,2,1,2,0],m=[0,3,4,0,4,1,1,4,2,4,5,2,3,6,4,6,7,4,4,7,8,4,8,5],k=Phaser.Utils.Objects.IsPlainObject,P=Phaser.Utils.Objects.GetValue,O=function(e){function i(e,n,o,s,a,u){var h;return r(this,i),k(n)&&(n=P(u=n,"x",0),o=P(u,"y",0),s=P(u,"key",null),a=P(u,"frame",null)),(h=t(this,i,[e,n,o,s,a])).type="rexQuadImage",h.isNinePointMode=P(u,"ninePointMode",!1),h.fourPointsModeRTL=P(u,"rtl",!1),h.controlPoints=[],function(t){for(var e,i=t.isNinePointMode,n=i?9:4,r=t.vertices,o=t.faces,s=t.controlPoints,a=0;a<n;a++){var u=new p;r.push(u),s.push(new g(t,u));}a=0;for(var h=(e=i?m:t.fourPointsModeRTL?b:x).length;a<h;a+=3){var c=r[e[a+0]],l=r[e[a+1]],f=r[e[a+2]];o.push(new w(c,l,f));}i?(t.topLeft=s[0],t.topCenter=s[1],t.topRight=s[2],t.centerLeft=s[3],t.center=s[4],t.centerRight=s[5],t.bottomLeft=s[6],t.bottomCenter=s[7],t.bottomRight=s[8]):(t.topLeft=s[0],t.topRight=s[1],t.bottomLeft=s[2],t.bottomRight=s[3]);}(c(h)),h.hideCCW=!1,h.syncSize(),h}return a(i,e),s(i,[{key:"destroy",value:function(t){if(this.scene&&!this.ignoreDestroy){l(u(i.prototype),"destroy",this).call(this,t);for(var e=0,n=this.controlPoints.length;e<n;e++)this.controlPoints[e].destroy();this.controlPoints=void 0;}}},{key:"resetVerts",value:function(){this.dirtyCache[9]=-1;for(var t=function(t){var e,i=t.height,n=t.width;if(t.isNinePointMode){var r=(0+n)/2,o=(0+i)/2;e=[0,0,r,0,n,0,0,o,r,o,n,o,0,i,r,i,n,i];}else e=[0,0,n,0,0,i,n,i];return e}(this),e=this.width,i=this.height,n=this.frame.cutWidth/i/2,r=this.frame.cutHeight/i/2,o=this.frame.u0,s=this.frame.u1,a=this.frame.v0,u=s-o,h=this.frame.v1-a,c=this.controlPoints,l=0,f=t.length;l<f;l+=2){var d=t[l+0],y=t[l+1],v=l/2,g=d/i-n,p=y/i-r,w=o+u*(d/e),x=a+h*(y/i);this.vertices[v].set(g,-p,0).setUVs(w,x),c[v].resetLocalXY(d,y);}return this}},{key:"syncSize",value:function(){return this.setSizeToFrame(),this.setOrtho(this.width/this.height,1),this.resetVerts(),this}}]),i}(f);function j(t,e,i,n,r){var o=new O(this.scene,t,e,i,n,r);return this.scene.add.existing(o),o}var X=Phaser.Utils.Objects.GetAdvancedValue,Y=Phaser.GameObjects.BuildGameObject;function _(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=X(t,"key",null),n=X(t,"frame",null),r=new O(this.scene,0,0,i,n,t);return Y(this.scene,r,t),r}var R,S=Phaser.Textures.DynamicTexture,G=function(t,e,i){return void 0===e&&(e=2),void 0===i&&(i=2),new S(t.sys.textures,null,e,i)},T=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},M=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height},V=Phaser.Geom.Rectangle,C=Phaser.Math.Vector2,L=Phaser.Math.RotateAround,B=function(t,e){if(void 0===e?e=new V:!0===e&&(void 0===D&&(D=new V),e=D),t.getBounds)return t.getBounds(e);var i,n,r,o,s,a,u,h;if(t.parentContainer){var c=t.parentContainer.getBoundsTransformMatrix();U(t,e),c.transformPoint(e.x,e.y,e),i=e.x,n=e.y,W(t,e),c.transformPoint(e.x,e.y,e),r=e.x,o=e.y,A(t,e),c.transformPoint(e.x,e.y,e),s=e.x,a=e.y,I(t,e),c.transformPoint(e.x,e.y,e),u=e.x,h=e.y;}else U(t,e),i=e.x,n=e.y,W(t,e),r=e.x,o=e.y,A(t,e),s=e.x,a=e.y,I(t,e),u=e.x,h=e.y;return e.x=Math.min(i,r,s,u),e.y=Math.min(n,o,a,h),e.width=Math.max(i,r,s,u)-e.x,e.height=Math.max(n,o,a,h)-e.y,e},D=void 0,U=function(t,e,i){return void 0===e?e=new C:!0===e&&(void 0===z&&(z=new C),e=z),t.getTopLeft?t.getTopLeft(e):(e.x=t.x-T(t)*t.originX,e.y=t.y-M(t)*t.originY,H(t,e,i))},W=function(t,e,i){return void 0===e?e=new C:!0===e&&(void 0===z&&(z=new C),e=z),t.getTopRight?t.getTopRight(e):(e.x=t.x-T(t)*t.originX+T(t),e.y=t.y-M(t)*t.originY,H(t,e,i))},A=function(t,e,i){return void 0===e?e=new C:!0===e&&(void 0===z&&(z=new C),e=z),t.getBottomLeft?t.getBottomLeft(e):(e.x=t.x-T(t)*t.originX,e.y=t.y-M(t)*t.originY+M(t),H(t,e,i))},I=function(t,e,i){return void 0===e?e=new C:!0===e&&(void 0===z&&(z=new C),e=z),t.getBottomRight?t.getBottomRight(e):(e.x=t.x-T(t)*t.originX+T(t),e.y=t.y-M(t)*t.originY+M(t),H(t,e,i))},z=void 0,H=function(t,e,i){(void 0===i&&(i=!1),0!==t.rotation&&L(e,t.x,t.y,t.rotation),i&&t.parentContainer)&&t.parentContainer.getBoundsTransformMatrix().transformPoint(e.x,e.y,e);return e},Q=Phaser.Geom.Rectangle,E=Phaser.Geom.Rectangle.Union,N=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:function(t){if("object"!==n(t)||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];}(e),i){e.length=t.length;for(var r=0,o=t.length;r<o;r++)e[r]=t[r];}else for(var s in t)e[s]=t[s];return e},F=Phaser.GameObjects.GameObject,q=Phaser.Utils.Objects.GetValue,J=function(t){if(t){var e,i,n=t.gameObjects,r=t.renderTexture,o=t.saveTexture,s=q(t,"x",void 0),a=q(t,"y",void 0),u=q(t,"width",void 0),h=q(t,"height",void 0),c=q(t,"originX",0),l=q(t,"originY",0),f=q(t,"padding",0);if(void 0===u||void 0===h||void 0===s||void 0===a){var d=function(t,e){var i;void 0===e?e=new Q:!0===e&&(void 0===R&&(R=new Q),e=R),e.setTo(0,0,0,0);for(var n=!0,r=0,o=t.length;r<o;r++)if((i=t[r]).getBounds){var s=B(i,!0);n?(e.setTo(s.x,s.y,s.width,s.height),n=!1):E(s,e,e);}return e}(n,!0);void 0!==s&&void 0!==a?(u=2*Math.max(s-d.left,d.right-s),h=2*Math.max(a-d.top,d.bottom-a),c=.5,l=.5):(s=d.x,a=d.y,u=d.width,h=d.height,c=0,l=0),e=d.x,i=d.y;}else e=s+(0-c)*u,i=a+(0-l)*h;e-=f,i-=f,u+=2*f,h+=2*f;var y=n[0].scene,v=y.sys.textures;return o&&!r&&(r=v.addDynamicTexture(o,u,h)),r||(r=y.add.renderTexture(0,0,u,h)),r.setPosition&&r.setPosition(s,a),r.width===u&&r.height===h||r.setSize(u,h),r.setOrigin&&r.setOrigin(c,l),r.camera.setScroll(e,i),n=function(t,e){if(t.length<=1)return t;var i;void 0===e&&(e=!1);for(var n=0,r=t.length;n<r;n++){var o=t[n];if(o.displayList?i=o.displayList:o.parentContainer&&(i=o.parentContainer.list),i)break}return i||(i=o.scene.sys.displayList),i.depthSort&&(i.depthSort(),i=i.list),e?t.sort((function(t,e){return i.indexOf(e)-i.indexOf(t)})):t.sort((function(t,e){return i.indexOf(t)-i.indexOf(e)})),t}(N(n)),r.draw(n),o&&(r instanceof F?r.saveTexture(o):r.key!==o&&v.renameTexture(r.key,key)),r}},K=Phaser.Utils.Objects.IsPlainObject,Z=Phaser.Utils.Objects.GetValue,$=function(e){function i(e,n,o,s,a,u){var h;return r(this,i),K(n)&&(n=Z(u=n,"x",0),o=Z(u,"y",0),s=Z(u,"width",32),a=Z(u,"height",32)),(h=t(this,i,[e,n,o,G(e,s,a),null,u])).type="rexQuadRenderTexture",h.rt=h.texture,h}return a(i,e),s(i,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(l(u(i.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null);}},{key:"snapshot",value:function(t,e){return void 0===e&&(e={}),e.gameObjects=t,e.renderTexture=this.rt,J(e),this.width===this.frame.realWidth&&this.height===this.frame.realHeight||this.syncSize(),this}}]),i}(O);function tt(t,e,i,n,r){var o=new $(this.scene,t,e,i,n,r);return this.scene.add.existing(o),o}var et=Phaser.Utils.Objects.GetAdvancedValue,it=Phaser.GameObjects.BuildGameObject;function nt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=et(t,"width",32),n=et(t,"height",32),r=new $(this.scene,0,0,i,n,t);return it(this.scene,r,t),r}var rt=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);for(var n=.5*t.width,r=.5*t.height,o=Math.tan(e)*r,s=Math.tan(i)*n,a=t.controlPoints,u=0,h=a.length;u<h;u++){var c=a[u],l=c.localXOrigin,f=c.localYOrigin;c.localX=l+(f>r?o:-o),c.localY=f+(l>n?s:-s);}},ot=Phaser.Utils.Objects.IsPlainObject,st=Phaser.Utils.Objects.GetValue,at=Phaser.Math.DegToRad,ut=Phaser.Math.RadToDeg,ht=function(e){function i(e,n,o,s,a){var u;if(r(this,i),ot(n)){var h=n;n=st(h,"x",0),o=st(h,"y",0),s=st(h,"key",null),a=st(h,"frame",null);}return (u=t(this,i,[e,n,o,s,a])).type="rexSkewmage",u._skewX=0,u._skewY=0,u}return a(i,e),s(i,[{key:"skewX",get:function(){return this._skewX},set:function(t){this._skewX=t,rt(this,this._skewX,this._skewY);}},{key:"skewXDeg",get:function(){return ut(this._skewX)},set:function(t){this.skewX=at(t);}},{key:"skewY",get:function(){return this._skewY},set:function(t){this._skewY=t,rt(this,this._skewX,this._skewY);}},{key:"skewYDeg",get:function(){return ut(this._skewY)},set:function(t){this.skewY=at(t);}},{key:"setSkewX",value:function(t){return this.skewX=t,this}},{key:"setSkewY",value:function(t){return this.skewY=t,this}},{key:"setSkew",value:function(t,e){return void 0===e&&(e=t),this.skewX=t,this.skewY=e,this}},{key:"setSkewXDeg",value:function(t){return this.skewXDeg=t,this}},{key:"setSkewYDeg",value:function(t){return this.skewYDeg=t,this}},{key:"setSkewDeg",value:function(t,e){return void 0===e&&(e=t),this.skewXDeg=t,this.skewYDeg=e,this}}]),i}(O);function ct(t,e,i,n){var r=new ht(this.scene,t,e,i,n);return this.scene.add.existing(r),r}var lt=Phaser.Utils.Objects.GetAdvancedValue,ft=Phaser.GameObjects.BuildGameObject;function dt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=lt(t,"key",null),n=lt(t,"frame",null),r=new ht(this.scene,0,0,i,n);return ft(this.scene,r,t),r}var yt=Phaser.Utils.Objects.IsPlainObject,vt=Phaser.Utils.Objects.GetValue,gt=function(e){function i(e,n,o,s,a){var u;if(r(this,i),yt(n)){var h=n;n=vt(h,"x",0),o=vt(h,"y",0),s=vt(h,"width",32),a=vt(h,"height",32);}return (u=t(this,i,[e,n,o,G(e,s,a),null])).type="rexSkewRenderTexture",u.rt=u.texture,u}return a(i,e),s(i,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(l(u(i.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null);}}]),i}(ht);function pt(t,e,i,n){var r=new gt(this.scene,t,e,i,n);return this.scene.add.existing(r),r}var wt=Phaser.Utils.Objects.GetAdvancedValue,xt=Phaser.GameObjects.BuildGameObject;function bt(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=wt(t,"width",32),n=wt(t,"height",32),r=new gt(this.scene,0,0,i,n);return xt(this.scene,r,t),r}var mt=Phaser.Utils.Objects.GetValue,kt=function(t,e){if(!t)return !1;for(var i=e.visibleSibling,n=0,r=i.length;n<r;n++)t.setChildVisible(i[n],!0);return i.length=0,t.setChildVisible(e,!1),e.isRunning=!1,!0},Pt=function(e){function i(){return r(this,i),t(this,i,arguments)}return a(i,e),s(i,[{key:"skewState",get:function(){return this.isRunning}}]),i}(function(e){function i(e,n){var o;r(this,i);var s=e.scene;return o=t(this,i,[s,0,0,1,1,n]),s.add.existing(c(o)),function(t,e,i){e.visibleSibling=[],e.isRunning=!1,e.useParentBounds=mt(i,"useParentBounds",!1),e.setPosition(t.x,t.y).setVisible(!1),t.pin(e);}(e,c(o),n),o}return a(i,e),s(i,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(this.exit(),l(u(i.prototype),"destroy",this).call(this,t));}},{key:"enter",value:function(){return function(t,e){if(!t)return !1;kt(t,e);var i=e.useParentBounds;J({gameObjects:t.getAllVisibleChildren(),renderTexture:e.rt,x:e.x,y:e.y,width:i?t.displayWidth:void 0,height:i?t.displayHeighth:void 0,originX:i?t.originX:void 0,originY:i?t.originY:void 0}),t.setChildVisible(e,!0);for(var n=e.visibleSibling,r=t.children,o=0,s=r.length;o<s;o++){var a=r[o];a.visible&&a!==e&&(t.setChildVisible(a,!1),n.push(a));}return e.isRunning=!0,!0}(this.rexContainer.parent,this)&&this.syncSize(),this}},{key:"exit",value:function(){return kt(this.rexContainer.parent,this),this}}]),i}(gt)),Ot=function(t){return null==t||""===t||0===t.length},jt=function(t,e,i,r){if(void 0===r&&(r="."),"object"===n(t)){if(Ot(e)){if(null==i)return;"object"===n(i)&&(t=i);}else {"string"==typeof e&&(e=e.split(r));var o=e.pop(),s=function(t,e,i){var r=t;if(Ot(e));else {var o;"string"==typeof e&&(e=e.split("."));for(var s=0,a=e.length;s<a;s++){var u;null!=r[o=e[s]]&&"object"===n(r[o])||(u=s===a-1?void 0===i?{}:i:{},r[o]=u),r=r[o];}}return r}(t,e);s[o]=i;}return t}},Xt=function(e){function i(e){var n;return r(this,i),n=t(this,i,[e]),e.registerGameObject("rexQuadImage",j,_),e.registerGameObject("rexQuadRenderTexture",tt,nt),e.registerGameObject("rexSkewImage",ct,dt),e.registerGameObject("rexSkewRenderTexture",pt,bt),n}return a(i,Phaser.Plugins.BasePlugin),s(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}},{key:"addContainerSkew",value:function(t,e){return new Pt(t,e)}}]),i}();return jt(window,"RexPlugins.GameObjects.QuadImage",O),jt(window,"RexPlugins.GameObjects.QuadRenderTexture",$),jt(window,"RexPlugins.GameObjects.SkewImage",ht),jt(window,"RexPlugins.GameObjects.SkewRenderTexture",gt),jt(window,"RexPlugins.GameObjects.ContainerSkew",Pt),Xt}));
