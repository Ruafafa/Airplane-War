!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexloadinganimationsceneplugin=t();}(undefined,(function(){function e(e,n,o){return n=u(n),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,t()?Reflect.construct(n,o||[],u(e).constructor):n.apply(e,o))}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));}catch(e){}return (t=function(){return !!e})()}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===t?String:Number)(e)}(e,"string");return "symbol"==typeof t?t:String(t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r);}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t);}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},a.apply(this,arguments)}var f=Phaser.Loader.FILE_POPULATED,l=Phaser.Utils.String.UUID,p=function(t){function n(t,r){return o(this,n),r.hasOwnProperty("type")||(r.type="await"),r.hasOwnProperty("url")||(r.url=""),r.hasOwnProperty("key")||(r.key=l()),e(this,n,[t,r])}return c(n,Phaser.Loader.File),i(n,[{key:"load",value:function(){if(this.state===f)this.loader.nextFile(this,!0);else {var e=this.config,t=e.callback,n=e.scope;if(t){var o=this,r=!1,i=function(){r||(o.onLoad(),r=!0);},c=function(){r||(o.onError(),r=!0);};n?t.call(n,i,c):t(i,c);}else this.onLoad();}}},{key:"onLoad",value:function(){this.loader.nextFile(this,!0);}},{key:"onError",value:function(){this.loader.nextFile(this,!1);}}]),n}(),y=Phaser.Utils.Objects.IsPlainObject,h=function(e,t){var n;(n=e)&&"function"==typeof n?t={config:{callback:e,scope:t}}:y(e)?(t=e).hasOwnProperty("config")||(t={config:t}):t={key:e,config:t};return this.addFile(new p(this,t)),this},d=Phaser.Scene,v=function(e){return e instanceof d},b=function(e,t){void 0===t&&(t=0);var n=(e=function(e){return v(e)?e.load:e}(e)).totalToLoad-t;return 1-(e.list.size+e.inflight.size-t)/n},g=function(t){function n(t){var r;return o(this,n),(r=e(this,n)).scene=t,r.boot(),r}return c(n,Phaser.Events.EventEmitter),i(n,[{key:"boot",value:function(){var e=this,t=this.scene.load;h.call(t,(function(n,o){var r=function(){var n=b(t,1);(e.emit("progress",n),1===n)&&(0===e.listenerCount("complete")?c():e.emit("complete",c));},i=!1,c=function(){i||(i=!0,e.emit("shutdown"),t.off("progress",r),n(),e.destroy());};t.on("progress",r);}));}},{key:"destroy",value:function(){this.scene=void 0,a(u(n.prototype),"destroy",this).call(this);}}]),n}(),P=Phaser.Utils.Objects.IsPlainObject;return function(t){function n(t){var r;return o(this,n),r=e(this,n,[t]),t.registerFileType("rexAwait",h),r}return c(n,Phaser.Plugins.BasePlugin),i(n,[{key:"addToScene",value:function(e){e.sys.load.rexAwait=h;}},{key:"startScene",value:function(e,t,n,o){!function(e,t,n,o,r){if(P(e)){var i=e;e=i.mainScene,t=i.animationScene,o=i.onLoadingComplete,r=i.onLoadingProgress;}else "function"==typeof n&&(r=o,o=n,n=void 0);v(t)&&(t=(c=t).sys.settings.key),e.scene.getStatus(t)<Phaser.Scenes.START&&e.scene.launch(t,n);var c=e.scene.get(t);new g(e).on("progress",(function(e){r&&r(e,c);})).on("complete",(function(e){o?o(e,c):e();})).on("shutdown",(function(){c.scene.stop();}));}(e,t,n,o);}}]),n}()}));
