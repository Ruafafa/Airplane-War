!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexrestorabledataplugin=t();}(undefined,(function(){function e(e,r,i){return r=u(r),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(e,t()?Reflect.construct(r,i||[],u(e).constructor):r.apply(e,i))}function t(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));}catch(e){}return (t=function(){return !!e})()}function r(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===t?String:Number)(e)}(e,"string");return "symbol"==typeof t?t:String(t)}function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r(n.key),n);}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t);}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},c.apply(this,arguments)}var f=function(e){if("object"!==i(e)||null===e)return e;if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t];return e},v=Phaser.Data.DataManager,y=Phaser.Utils.Objects.GetValue,p=Phaser.Events.EventEmitter,_=function(t){function r(t,i,o){var s;n(this,r);var a=void 0===i;if(a&&(i=new p),s=e(this,r,[t,i]),a){var u=t.events?t.events:t;u&&u.once("destroy",s.destroy,h(s));}return s._recordEnable=!0,s.resetFromJSON(o),s.events.on("changedata",s.onValueChange,h(s)).on("setdata",(function(e,t,r){this.onValueChange(e,t,r,null);}),h(s)).on("removedata",(function(e,t,r){this.onValueChange(e,t,null,r);}),h(s)),s}return a(r,t),s(r,[{key:"resetFromJSON",value:function(e){this._version=y(e,"version",0),this._versionAlias=y(e,"versionAlias",""),this._repository=y(e,"repository",[]),this._versionAliases=y(e,"versionAliases",{});var t=y(e,"changeList",{}),r=y(e,"data",void 0);if(r)this._recordEnable=!1,this.set(r),this._recordEnable=!0;else {var i=""!==this._versionAlias?this._versionAlias:this._version;for(var n in this._version=0,this.restore(i),this._recordEnable=!1,t)this.setValue(n,t[n][0]);this._recordEnable=!0;}this._changeList=t;}},{key:"toJSON",value:function(e){void 0===e&&(e=!1);var t={version:this._version,versionAlias:this._versionAlias,changeList:this._changeList,repository:this._repository,versionAliases:this._versionAliases};return e&&(t.data=this.list),t}},{key:"version",get:function(){return this._version},set:function(e){var t;if("string"==typeof e&&(t=e,e=this._versionAliases[e]),"number"==typeof e){if(this._versionAlias=t||"",0===e)return this._recordEnable=!1,c(u(r.prototype),"reset",this).call(this),this._version=0,f(this._changeList),void(this._recordEnable=!0);e=Math.min(e,this._repository.length);var i,n={};for(var o in this._changeList)n[o]=this._changeList[o][1],delete this._changeList[o];if(this._version===e);else if(this._version<e)for(var s=this._version;s<e;s++)for(var o in i=this._repository[s])n[o]=i[o][0];else for(s=this._version-1;s>=e;s--)for(var o in i=this._repository[s])n[o]=i[o][1];for(var o in this._version=e,this._recordEnable=!1,n)null===(e=n[o])?this.removeValue(o):this.setValue(o,e);this._recordEnable=!0;}else this._versionAlias="";}},{key:"versionAlias",get:function(){return this._versionAlias}},{key:"lastVersion",get:function(){return this._repository.length}},{key:"versionAliases",get:function(){var e=[];for(var t in this._versionAliases)e.push(t);return e}},{key:"commit",value:function(e){for(var t in this._repository.length=this._version,this._versionAliases)this._versionAliases[t]>this._version&&delete this._versionAliases[t];return this._repository.push(this._changeList),this._changeList={},this._version++,"string"==typeof e&&(this._versionAlias=e,this._versionAliases[e]=this._version),this}},{key:"restore",value:function(e,t){return void 0===e&&(e=""!==this._versionAlias?this._versionAlias:this._version),void 0===t&&(t=!1),t&&(this.version=0),this.version=e,this}},{key:"reset",value:function(){return this.restore(0),this._repository.length=0,f(this._versionAliases),this}},{key:"onValueChange",value:function(e,t,r,i){this._recordEnable&&(this._changeList.hasOwnProperty(t)?this._changeList[t][0]=r:this._changeList[t]=[r,i]);}}]),r}(v);return function(t){function r(t){return n(this,r),e(this,r,[t])}return a(r,Phaser.Plugins.BasePlugin),s(r,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}},{key:"add",value:function(e,t,r){return new _(e,t,r)}}]),r}()}));
