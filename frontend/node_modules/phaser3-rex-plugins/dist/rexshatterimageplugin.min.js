!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexshatterimageplugin=e();}(undefined,(function(){function t(t,r,n){return r=u(r),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,e()?Reflect.construct(r,n||[],u(t).constructor):r.apply(t,n))}function e(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));}catch(t){}return (e=function(){return !!t})()}function r(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return ("string"===e?String:Number)(t)}(t,"string");return "symbol"==typeof e?e:String(e)}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i);}}function o(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e);}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},c.apply(this,arguments)}var l=function(e){function r(){return i(this,r),t(this,r,arguments)}return a(r,e),o(r,[{key:"tint",get:function(){return 0===this.vertices.length?16777215:this.vertices[0].color}},{key:"forceUpdate",value:function(){return this.dirtyCache[10]=1,this}}]),r}(Phaser.GameObjects.Mesh);function f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var v={exports:{}};!function(t){var e;!function(){var r=1/1048576;function n(t,e,n,i){var s,o,a,u,h,c,l,f,v,y,p=t[e][0],g=t[e][1],d=t[n][0],m=t[n][1],b=t[i][0],P=t[i][1],w=Math.abs(g-m),x=Math.abs(m-P);if(w<r&&x<r)throw new Error("Eek! Coincident points!");return w<r?o=(u=-(b-d)/(P-m))*((s=(d+p)/2)-(c=(d+b)/2))+(f=(m+P)/2):x<r?o=(a=-(d-p)/(m-g))*((s=(b+d)/2)-(h=(p+d)/2))+(l=(g+m)/2):(s=((a=-(d-p)/(m-g))*(h=(p+d)/2)-(u=-(b-d)/(P-m))*(c=(d+b)/2)+(f=(m+P)/2)-(l=(g+m)/2))/(a-u),o=w>x?a*(s-h)+l:u*(s-c)+f),{i:e,j:n,k:i,x:s,y:o,r:(v=d-s)*v+(y=m-o)*y}}function i(t){var e,r,n,i,s,o;for(r=t.length;r;)for(i=t[--r],n=t[--r],e=r;e;)if(o=t[--e],n===(s=t[--e])&&i===o||n===o&&i===s){t.splice(r,2),t.splice(e,2);break}}e={triangulate:function(t,e){var s,o,a,u,h,c,l,f,v,y,p,g,d=t.length;if(d<3)return [];if(t=t.slice(0),e)for(s=d;s--;)t[s]=t[s][e];for(a=new Array(d),s=d;s--;)a[s]=s;for(a.sort((function(e,r){return t[r][0]-t[e][0]})),u=function(t){var e,r,n,i,s,o,a=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<u&&(u=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=c-u,[[(s=a+.5*(r=h-a))-20*(i=Math.max(r,n)),(o=u+.5*n)-i],[s,o+20*i],[s+20*i,o-i]]}(t),t.push(u[0],u[1],u[2]),h=[n(t,d+0,d+1,d+2)],c=[],l=[],s=a.length;s--;l.length=0){for(g=a[s],o=h.length;o--;)(f=t[g][0]-h[o].x)>0&&f*f>h[o].r?(c.push(h[o]),h.splice(o,1)):f*f+(v=t[g][1]-h[o].y)*v-h[o].r>r||(l.push(h[o].i,h[o].j,h[o].j,h[o].k,h[o].k,h[o].i),h.splice(o,1));for(i(l),o=l.length;o;)p=l[--o],y=l[--o],h.push(n(t,y,p,g));}for(s=h.length;s--;)c.push(h[s]);for(h.length=0,s=c.length;s--;)c[s].i<d&&c[s].j<d&&c[s].k<d&&h.push(c[s].i,c[s].j,c[s].k);return h},contains:function(t,e){if(e[0]<t[0][0]&&e[0]<t[1][0]&&e[0]<t[2][0]||e[0]>t[0][0]&&e[0]>t[1][0]&&e[0]>t[2][0]||e[1]<t[0][1]&&e[1]<t[1][1]&&e[1]<t[2][1]||e[1]>t[0][1]&&e[1]>t[1][1]&&e[1]>t[2][1])return null;var r=t[1][0]-t[0][0],n=t[2][0]-t[0][0],i=t[1][1]-t[0][1],s=t[2][1]-t[0][1],o=r*s-n*i;if(0===o)return null;var a=(s*(e[0]-t[0][0])-n*(e[1]-t[0][1]))/o,u=(r*(e[1]-t[0][1])-i*(e[0]-t[0][0]))/o;return a<0||u<0||a+u>1?null:[a,u]}},t.exports=e;}();}(v);var y=f(v.exports),p=Phaser.Geom.Triangle,g=function(t,e){void 0===e&&(e=!0);var r=y.triangulate(t);if(e){for(var n=[],i=0,s=r.length;i<s;i+=3){var o=t[r[i+0]],a=t[r[i+1]],u=t[r[i+2]],h=new p(o[0],o[1],a[0],a[1],u[0],u[1]);n.push(h);}return n}return {vertices:t,indices:r}},d=Phaser.Utils.Objects.GetValue,m=Phaser.Math.Clamp,b=[1/27,3/27,9/27],P=function(t,e,r,n,i,s,o,a,u,h,c,l){var f=[];f.push([t,e]);for(var v=Math.min(r,n),y=0,p=i.length;y<p;y++)x(f,t,e,v*i[y],s,o,a,u,h,c,l);v=2*Math.max(r,n);return x(f,t,e,v,s,o,a,u,h,c,l),f},w=2*Math.PI,x=function(t,e,r,n,i,s,o,a,u,h,c){for(var l=0;l<i;l++){var f=l/i*w,v=e+Math.cos(f)*n*O(s,o),y=r+Math.sin(f)*n*O(s,o);v=m(v,a,u),y=m(y,h,c),t.push([v,y]);}return t},O=function(t,e){return t===e?t:t+(e-t)*Math.random()},j=Phaser.Geom.Mesh.Face,R=Phaser.Math.DegToRad,k=Phaser.Math.RadToDeg,I=Phaser.Geom.Mesh.RotateFace,G=function(e){function r(e,n,s){var o;return i(this,r),(o=t(this,r,[e,n,s]))._rotation=0,o}return a(r,e),o(r,[{key:"rotation",get:function(){return this._rotation},set:function(t){I(this,t-this._rotation),this._rotation=t;}},{key:"setRotation",value:function(t){return this.rotation=t,this}},{key:"angle",get:function(){return k(this.rotation)},set:function(t){this.rotation=R(t);}},{key:"setAngle",value:function(t){return this.angle=t,this}},{key:"setAlpha",value:function(t){return this.alpha=t,this}},{key:"tint",get:function(){var t=this.vertex1.color,e=this.vertex2.color,r=this.vertex3.color;return (((t>>0&255)+(e>>0&255)+(r>>0&255))/3<<0)+(((t>>8&255)+(e>>8&255)+(r>>8&255))/3<<8)+(((t>>16&255)+(e>>16&255)+(r>>16&255))/3<<16)},set:function(t){this.vertex1.color=t,this.vertex2.color=t,this.vertex3.color=t;}},{key:"setTint",value:function(t){return this.tint=t,this}}]),r}(j),T=Phaser.Math.RotateAround,S={x:0,y:0},M=Phaser.Utils.Objects.IsPlainObject,_=Phaser.Utils.Objects.GetValue,N=Phaser.Geom.Mesh.GenerateGridVerts,C=Phaser.Geom.Mesh.Vertex,E=Phaser.Math.Distance.Squared,V=[1/27,3/27,9/27],L=function(e){function r(e,n,s,o,a,u){var h;return i(this,r),M(n)&&(n=_(u=n,"x",0),s=_(u,"y",0),o=_(u,"key",null),a=_(u,"frame",null)),(h=t(this,r,[e,n,s,o,a])).type="rexShatterImage",h.hideCCW=!1,h.resetImage(),h.shatterCenter={x:null,y:null},h.setRingRadiusList(_(u,"ringRadiusList",V)),h.setSamplesPerRing(_(u,"samplesPerRing",12)),h.setVariation(_(u,"variation",.25)),h}return a(r,e),o(r,[{key:"setRingRadiusList",value:function(t){return this.ringRadiusList=t,this}},{key:"setSamplesPerRing",value:function(t){return this.samplesPerRing=t,this}},{key:"setVariation",value:function(t){return this.variation=t,this}},{key:"resetImage",value:function(){return this.setSizeToFrame(),this.clear(),this.dirtyCache[9]=-1,N({mesh:this,width:this.frame.cutWidth/this.height,height:this.frame.cutHeight/this.height}),this.setOrtho(this.width/this.height,1),this}},{key:"shatter",value:function(t,e,r){if(M(t)&&(r=t,t=void 0,e=void 0),M(r)&&(r.hasOwnProperty("centerX")&&(t=r.centerX),r.hasOwnProperty("centerY")&&(e=r.centerY),r.hasOwnProperty("ringRadiusList")&&this.setRingRadiusList(r.ringRadiusList),r.hasOwnProperty("samplesPerRing")&&this.setSamplesPerRing(r.samplesPerRing),r.hasOwnProperty("variation")&&this.setVariation(r.variation)),void 0===t)t=this.width/2,e=this.height/2;else {var n=(s=t,o=e,a=(i=this).width/2,u=i.height/2,S.x=s-i.x,S.y=o-i.y,S.x/=i.scaleX,S.y/=i.scaleY,T(S,0,0,-i.rotation),S.x+=a,S.y+=u,S);t=n.x,e=n.y;}var i,s,o,a,u;if(this.shatterCenter.x=t,this.shatterCenter.y=e,this.clear(),this.dirtyCache[9]=-1,0===this.width||0===this.height)return this;for(var h=function(t){var e,r,n,i,s,o,a=t.rectangle;a?(e=a.x,n=a.y,s=a.width,o=a.height):(e=0,n=0,s=t.width,o=t.height),r=e+s,i=n+o;var u,h,c=t.center;void 0===c?(u=(e+r)/2,h=(n+i)/2):(u=m(c.x,e,r),h=m(c.y,n,i));var l,f=d(t,"ringRadiusList",b),v=d(t,"samplesPerRing",12),y=d(t,"variation",.25),p=d(t,"triangleOutput",!0);(l=f)&&"function"==typeof l&&(f=f(s,o));for(var w=1-y,x=1+y,O=0;O<10;O++)try{var j=P(u,h,s,o,f,v,w,x,e,r,n,i);return g(j,p)}catch(t){}throw new Error("Generate triangles fail")}({width:this.width,height:this.height,center:this.shatterCenter,triangleOutput:!1,ringRadiusList:this.ringRadiusList,variation:this.variation,samplesPerRing:this.samplesPerRing}),c=h.vertices,l=h.indices,f=[],v=this.width,y=this.height,p=this.frame.cutWidth/y/2,w=this.frame.cutHeight/y/2,x=this.frame.u0,O=this.frame.u1,j=this.frame.v0,R=O-x,k=this.frame.v1-j,I=0,_=c.length;I<_;I++){var N=c[I],V=N[0],L=N[1];f.push({g:E(t,e,V,L),x:V/y-p,y:L/y-w,u:x+R*(V/v),v:j+k*(L/y)});}for(I=0,_=l.length;I<_;I+=3){var U=f[l[I+0]],D=f[l[I+1]],A=f[l[I+2]],F=new C(U.x,-U.y,0,U.u,U.v),Y=new C(D.x,-D.y,0,D.u,D.v),B=new C(A.x,-A.y,0,A.u,A.v),W=new G(F,Y,B);this.vertices.push(F,Y,B),this.faces.push(W),W.g=Math.min(U.g,D.g,A.g);}return this.faces.sort((function(t,e){return t.g-e.g})),this}},{key:"startUpdate",value:function(){return this.ignoreDirtyCache=!0,this}},{key:"stopUpdate",value:function(){return this.ignoreDirtyCache=!1,this}}]),r}(l);function U(t,e,r,n,i){var s=new L(this.scene,t,e,r,n,i);return this.scene.add.existing(s),s}var D=Phaser.Utils.Objects.GetAdvancedValue,A=Phaser.GameObjects.BuildGameObject;function F(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=D(t,"key",null),n=D(t,"frame",null),i=new L(this.scene,0,0,r,n,t);return A(this.scene,i,t),i}var Y=Phaser.Textures.DynamicTexture,B=Phaser.Utils.Objects.IsPlainObject,W=Phaser.Utils.Objects.GetValue,X=function(e){function r(e,n,s,o,a,u){var h;i(this,r),B(n)&&(n=W(u=n,"x",0),s=W(u,"y",0),o=W(u,"width",32),a=W(u,"height",32));var c=function(t,e,r){return void 0===e&&(e=2),void 0===r&&(r=2),new Y(t.sys.textures,null,e,r)}(e,o,a);return (h=t(this,r,[e,n,s,c,null,u])).type="rexShatterRenderTexture",h.rt=h.texture,h}return a(r,e),o(r,[{key:"destroy",value:function(t){this.scene&&!this.ignoreDestroy&&(c(u(r.prototype),"destroy",this).call(this,t),this.rt.destroy(),this.rt=null);}}]),r}(L);function H(t,e,r,n,i){var s=new X(this.scene,t,e,r,n,i);return this.scene.add.existing(s),s}var q=Phaser.Utils.Objects.GetAdvancedValue,z=Phaser.GameObjects.BuildGameObject;function J(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var r=q(t,"width",32),n=q(t,"height",32),i=new X(this.scene,0,0,r,n,t);return z(this.scene,i,t),i}var K=function(t){return null==t||""===t||0===t.length},Q=function(t,e,r,i){if(void 0===i&&(i="."),"object"===n(t)){if(K(e)){if(null==r)return;"object"===n(r)&&(t=r);}else {"string"==typeof e&&(e=e.split(i));var s=e.pop(),o=function(t,e,r){var i=t;if(K(e));else {var s;"string"==typeof e&&(e=e.split("."));for(var o=0,a=e.length;o<a;o++){var u;null!=i[s=e[o]]&&"object"===n(i[s])||(u=o===a-1?void 0===r?{}:r:{},i[s]=u),i=i[s];}}return i}(t,e);o[s]=r;}return t}},Z=function(e){function r(e){var n;return i(this,r),n=t(this,r,[e]),e.registerGameObject("rexShatterImage",U,F),e.registerGameObject("rexShatterRenderTexture",H,J),n}return a(r,Phaser.Plugins.BasePlugin),o(r,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this);}}]),r}();return Q(window,"RexPlugins.GameObjects.ShatterImage",L),Q(window,"RexPlugins.GameObjects.ShatterRenderTexture",X),Z}));
